data StateType 		
  = Q0  
  | Q1
  | Q2
    deriving (Eq, Show)

template Market
  with 
    owner       : Party
    buyer       : Party
    state       : StateType

  where
    signatory owner 
    ensure owner /= buyer  
    observer buyer

    choice O : ItemId
      controller owner
        do
          assertMsg "Item is not available for an offer." this.state == Q0

          create Market with
            state  = Q2

    choice 1 : ItemId
      controller owner
        do
          assertMsg "Item is not available for an offer." this.state == Q0

          create Market with
            state  = Q1

    choice O : ItemId
      controller owner
        do
          assertMsg "Item is not available for an offer." this.state == Q1

          create Market with
            state  = Q1

      choice 1 : ItemId
      controller owner
        do
          assertMsg "Item is not available for an offer." this.state == Q1

          create Market with
            state  = Q1

      choice O : ItemId
      controller owner
        do
          assertMsg "Item is not available for an offer." this.state == Q2

          create Market with
            state  = Q1

  